dnf install epel-release -y
yum install xorriso
yum install genisoimage
yum install mock
dnf install lorax -y

vim ks.cfg
#version=RHEL8
# Use graphical install
graphical
# Repositories
repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-hdd-device/AppStream
%packages
# --- Base Environment ---
@^minimal-environment

# --- Groups ---
@container-management
@development
@dotnet-core
@graphical-admin-tools
@guest-agents
@headless-management
@legacy-unix
@network-server
@rpm-development-tools
@scientific
@security-tools
@smart-card
@standard
@system-tools

# --- Individual packages ---
cmake
gperftools
mailx
mutt
wget
shc
socat
numactl
mcelog
chrony
sysstat
cyrus-sasl-plain
telnet
lsof
psmisc
linuxptp
bzip2-devel
rsync
tcpdump
ncurses-devel
gsl-devel
libnl3-devel
elfutils-libelf-devel
kernel-devel
mlocate
htop
python3-libselinux
net-tools
vim
traceroute
rsyslog
lapack
suitesparse
tar
crash
nmap-ncat
perf
%end

# Keyboard layouts
keyboard --xlayouts='us'

# System language
lang en_IN.UTF-8

# Network information
network --hostname=localhost.localdomain

# Installation source
harddrive --partition=/dev/sda2 --dir=/

# First boot agent
firstboot --enable

# Timezone
timezone Asia/Kolkata --isUtc
# Root password
rootpw --plaintext 123
# Create users
user --name=trading --uid=1000 --gecos="trading"
user --name=ops     --gecos="ops"
user --name=infra   --gecos="infra"
user --name=pravil  --gecos="pravil"
user --name=makwana --gecos="makwana"

# --- Disk detection and partitioning ---
%pre
DISK=""
if [ -b /dev/nvme0n1 ]; then
  DISK="nvme0n1"
elif [ -b /dev/sda ]; then
  DISK="sda"
elif [ -b /dev/sdb ]; then
  DISK="sdb"
fi
echo "ignoredisk --only-use=$DISK" > /tmp/part-include.ks
echo "clearpart --all --initlabel" >> /tmp/part-include.ks
echo "part /boot/efi --fstype=efi --ondisk=$DISK --size=1024 --fsoptions=\"umask=0077,shortname=winnt\"" >> /tmp/part-include.ks
echo "part /home  --fstype=xfs --ondisk=$DISK --size=40960" >> /tmp/part-include.ks
echo "part /      --fstype=xfs --ondisk=$DISK --size=10240 --grow" >> /tmp/part-include.ks
%end
%include /tmp/part-include.ks
# Kdump
%addon com_redhat_kdump --enable --reserve-mb='auto'
%end
# Password policies
%anaconda
pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
%end


281  mkisofs -o RockyCustom.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -R -J -v -T /dirforiso/
